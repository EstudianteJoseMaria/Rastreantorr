 
<!DOCTYPE html>
<html>
<head>
<title>websockets</title>
<meta charset="utf8" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<!-- Temas-->
<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">-->
<script>

var socket = new WebSocket("wss://localhost:9990");

function botonEntrar()
{
    document.getElementById("divlogin").style.display="none";
    document.getElementById("divIni").style.display="block";
}

function volverInicio()
{
    document.getElementById("divIni").style.visibility="visible";
    document.getElementById("busqueda").style.visibility="hidden";
    document.getElementById("retroceso").style.visibility="hidden";
}

function cancelarProducto() //Funcion para cancelar una busqueda
{
    var json = {id: "1", action: "cancelar", name: document.getElementById("cancelar").value};
    socket.send(JSON.stringify(json));
}

function revisarProducto() //Funcion para pedir si existe el producto
{
    var json = {id: "2", action: "estado", name:  document.getElementById("comprobar").value};
    socket.send(JSON.stringify(json));
    document.getElementById("divIni").style.visibility="hidden";
    document.getElementById("busqueda").style.visibility="visible";
    document.getElementById("retroceso").style.visibility="visible";
}

function agregarProducto() //Funcion para agregar un producto a la lista de productos
{
    var json = {id: "3", action: "agregar", name: document.getElementById("agregar").value, web: "www.amazon.es"}; //modificar la web
    socket.send(JSON.stringify(json));
}

function confirmacionDelete()
{
    var ok = confirm("Estas seguro de que quieres borrar el elemento?");
    if (ok == true)
    {
        cancelarProducto();
        alert("Se ha borrado con éxito");
    } //end if
}

socket.onopen = function(e) {
  alert("[open] Connection established");
  //alert("Sending to server");
  //socket.send("My name is John");
};

socket.onmessage = function(event) {
  //alert(`[message] Data received from server: ${event.data}`);
  console.log(event.data);
  var mensaje = JSON.parse(event.data);
  if (mensaje.action == "delete")
  {
    alert("Hay mas de una fila por borrar");
    confirm("Seguro que quieres borrar?");
  }
  else if (mensaje.action == "insert")
  {
    alert("Se han introducido los datos correctamente!!!");
  }
  else if (mensaje.action == "update")
  {
    alert("Modificado con éxito!!!");
  }
  else if (mensaje.action == "select")
  {
    alert("Ahora mismo hay estos procesos en búsqueda: ");
    var espaciado = document.createElement("br");
    for(var i = 0; i < Object.keys(mensaje.busqueda).length; i++) {       //Cada elemento se coloca en un div distinto

        var div = document.createElement("div");
        var nombres = document.createElement("nombre");
        var nombre = document.createTextNode(mensaje.busqueda.nombre[i]);

        nombres.appendChild(nombre);
        var estados = document.createElement("estados");
        var estado = document.createTextNode(mensaje.busqueda.estado[i]);

        estados.appendChild(estado);
        var tiempos = document.createElement("tiempo");
        var tiempo = document.createTextNode(mensaje.busqueda.tiempo[i]);

        tiempos.appendChild(tiempo);
        var recursos = document.createElement("recursos");
        var recurso = document.createTextNode(mensaje.busqueda.recurso[i]);

        recursos.appendChild(recurso);

        /*div.appendChild(nombres);
        div.appendChild(estados);
        div.appendChild(tiempos);
        div.appendChild(recursos);*/

        document.getElementById("nombre").appendChild(nombres);
        document.getElementById("estado").appendChild(estados);
        document.getElementById("tiempo").appendChild(tiempos);
        document.getElementById("direccion").appendChild(recursos);
    }

  };
}

socket.onclose = function(event) {
  if (event.wasClean) {
    alert(`[close] Connection closed cleanly, code=${event.code} reason=${event.reason}`);
  } else {
    // e.g. server process killed or network down
    // event.code is usually 1006 in this case
    // alert('[close] Connection died');
  }
};

socket.onerror = function(error) {
  alert(`[error] ${error.message}`);
};
</script>
</head>
<body style="background-color:white"> <!-- http://www.gitmedio.com/gitmedio/codigo-en-php-y-mysql-sistema-de-autenticacion/ -->

<!--Pagina de login -->
    <div id="divlogin" style="width: 400px; margin: 50px auto; background-color: #F3EDED; border: 1px solid #ECE8E8; height: 400px; border-radius:8px; padding: 0px 9px 0px 9px;">
        <div class="ContentForm">
            <!--<form action="" method="get" name="FormEntrar"> -->
                    <div style="margin: 40px 0px 0px -28%">
                      <input type="email" name="correo" placeholder="Correo" id="Correo" style="text-align: center; margin: 50px 0px 0px 32%; font-size: 14px height: 300px;" size="30" required>
                    </div>
                    <div style="margin: 10px 0px 0px -28%">
                      <input type="password" name="contra" placeholder="******" style="text-align: center; margin: 20px 0px 0px 32%; font-size: 14px;" size="30" required>
                    </div>
                    <br>
                    <button id="IngresoLog" type="" onclick="botonEntrar()">Entrar</button>
                    <div class="opcioncontra"><a href="">Olvidaste tu contraseña?</a></div>
            <!--</form>-->
        </div>
    </div>

<input type=image src="flecha.png" id="retroceso" width="50" height="50" style="position:absolute; visibility:hidden" onclick="volverInicio()"/>
    <div style = "padding: 100px 0px 0px 50px; display: none;" id="divIni"> <!-- Pagina del cliente -->
    <h1>Funciones disponibles:</h1>
        <div style="border: 2px solid #ccc;width: 365px; height:150px; margin-bottom: 20px; margin-left:8%; padding: 2% 0% 0% 1%; float:left;">
            1. Introduce el nombre del producto que quieras empezar a buscar: <br style="margin-bottom:30px">
            <input type="textfield" id="agregar" placeholder="Introduce el nombre del producto"/>
            <input type="button" value="Nuevo producto" onclick="agregarProducto()"/>
        </div>
        <div style="border: 2px solid #ccc;width: 370px; height:150px; margin-bottom: 20px; margin-left:8%; padding: 2% 0% 0% 1%; float:left;">
            2. Introduce el producto a cancelar: <br style="margin-bottom:30px">
            <input type="textfield" id="cancelar" placeholder="Introduce el nombre del producto"/>
            <input type="button" value="Cancelar producto" onclick="confirmacionDelete()"/>
        </div>
        <div style="border: 2px solid #ccc;width: 400px; height:150px; margin: 0px 0px 20px 8%; padding: 2% 0% 0% 1%; float:left;">
            3. Introduce el nombre del producto que quieres revisar: <br style="margin-bottom:30px">
            <input type="textfield" id="comprobar" placeholder="Introduce el nombre del producto"/>
            <input type="button" value="Comprobar producto" onclick="revisarProducto()"/>
        </div>
    </div>
    <div id="busqueda" style="border: 2px solid #ccc; width: 600px; height:150px; margin: 0px 0px 0%  30%;padding: 20px 0px 0px 50px; position:absolute; top:35%; visibility:hidden"><nombre id="nombre">Nombre: </nombre><br><estado id="estado">Estado: </estado><br> <tiempo id="tiempo">Tiempo transcurrido:</tiempo> <br> <direccion id="direccion">Dirección de búsqueda: </direccion>
    </div>
</body>
</html>
